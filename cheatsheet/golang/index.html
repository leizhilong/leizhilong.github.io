<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><title>Golang</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://leizhilong.github.io/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Lei Zhilong leizhilong kubernetes linux container golang mobile app back-end service blog]"><meta name=author content="leizhilong"><meta name=generator content="Hugo 0.75.1"><meta name=twitter:card content="summary"><meta name=twitter:title content="Golang"><meta name=twitter:description content="I. Struct 1. Ommit empty struct in `json.Marshal()' Suppose we have a nested struct like:
1 2 3 4 5 6 7 8 9 10  type Example struct { Info string `json:&#34;info,omitempty&#34;` ExampleValues struct { DayOfMonth int `json:&#34;dayOfMonth,omitempty&#34;` DateStr string `json:&#34;dateStr,omitempty&#34;` SomeRandomFloat float64 `json:&#34;someRandomFloat,omitempty&#34;` StrArray []string `json:&#34;strArray,omitempty&#34;` IsWorking bool `json:&#34;isWorking,omitempty&#34;` } `json:&#34;exampleValues,omitempty&#34;` }   And if only info filed is assinged with a value when initialized.
1 2  b, _ := json."><meta name=twitter:domain content="leizhilong"><meta name=twitter:creator content="@leizhilong"></head><body><header role=banner><hgroup><h1><a href=https://leizhilong.github.io/>Lei Zhilong</a></h1><h2>The best way to input is to output</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value;">
<option value>Navigate…</option>
<option value=https://leizhilong.github.io/post/>» Posts</option>
<option value=https://leizhilong.github.io/categories/>» Categories</option>
<option value=https://leizhilong.github.io/tags/>» Tags</option>
<option value=https://leizhilong.github.io/cheatsheet/>» CheatSheets</option>
<option value=https://leizhilong.github.io/about/>» About Me</option></select></fieldset><ul class=main-navigation><li><a href=https://leizhilong.github.io/post/ title=Posts>Posts</a></li><li><a href=https://leizhilong.github.io/categories/ title=Categories>Categories</a></li><li><a href=https://leizhilong.github.io/tags/ title=Tags>Tags</a></li><li><a href=https://leizhilong.github.io/cheatsheet/ title=CheatSheets>CheatSheets</a></li><li><a href=https://leizhilong.github.io/about/ title="About Me">About Me</a></li></ul><ul class=subscription><a href=https://leizhilong.github.io/index.xml target=_blank type=application/rss+xml title=RSS><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://leizhilong.github.io/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Jun 4, 2020
- 3 minute read
- <a href=https://leizhilong.github.io/cheatsheet/golang/#disqus_thread>Comments</a>
- <a class=label href=https://leizhilong.github.io/categories/cheat-sheets/>Cheat Sheets</a></p><h1 class=entry-title>Golang</h1></header><div class=entry-content><nav id=TableOfContents><ul><li><a href=#i-struct>I. Struct</a><ul><li><a href=#1-ommit-empty-struct-in-jsonmarshal>1. Ommit empty struct in `json.Marshal()'</a></li><li><a href=#2-avoid-omitempty-for-fields-that-are-asgined-with-0-or-empty-string>2. Avoid <em><code>omitempty</code></em> for fields that are asgined with 0 or empty string</a></li></ul></li><li><a href=#ii-design-pattern>II. Design Pattern</a><ul><li><a href=#21-singleton>2.1 Singleton</a></li></ul></li></ul></nav><h2 id=i-struct>I. Struct</h2><h3 id=1-ommit-empty-struct-in-jsonmarshal>1. Ommit empty struct in `json.Marshal()'</h3><p>Suppose we have a nested struct like:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8be9fd;font-style:italic>type</span> Example <span style=color:#8be9fd;font-style:italic>struct</span> {
  Info          <span style=color:#8be9fd>string</span> <span style=color:#f1fa8c>`json:&#34;info,omitempty&#34;`</span>
  ExampleValues <span style=color:#8be9fd;font-style:italic>struct</span> {
    DayOfMonth      <span style=color:#8be9fd>int</span>      <span style=color:#f1fa8c>`json:&#34;dayOfMonth,omitempty&#34;`</span>
    DateStr         <span style=color:#8be9fd>string</span>   <span style=color:#f1fa8c>`json:&#34;dateStr,omitempty&#34;`</span>
    SomeRandomFloat <span style=color:#8be9fd>float64</span>  <span style=color:#f1fa8c>`json:&#34;someRandomFloat,omitempty&#34;`</span>
    StrArray        []<span style=color:#8be9fd>string</span> <span style=color:#f1fa8c>`json:&#34;strArray,omitempty&#34;`</span>
    IsWorking       <span style=color:#8be9fd>bool</span>     <span style=color:#f1fa8c>`json:&#34;isWorking,omitempty&#34;`</span>
  } <span style=color:#f1fa8c>`json:&#34;exampleValues,omitempty&#34;`</span>
  }
</code></pre></td></tr></table></div></div><p>And if only <code>info</code> filed is assinged with a value when initialized.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>b, _ <span style=color:#ff79c6>:=</span> json.<span style=color:#50fa7b>Marshal</span>(<span style=color:#ff79c6>&amp;</span>Example{Info: <span style=color:#f1fa8c>&#34;hello&#34;</span>})
fmt.<span style=color:#50fa7b>Println</span>(<span style=color:#8be9fd;font-style:italic>string</span>(b))
</code></pre></td></tr></table></div></div><p>What we get will be:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#ff79c6>&#34;info&#34;</span>:<span style=color:#f1fa8c>&#34;hello&#34;</span>,<span style=color:#ff79c6>&#34;exampleValues&#34;</span>:{}}
</code></pre></td></tr></table></div></div><p>How do we omit <code>ExampleValues</code> field if it is not assigned with a value? Use a <em>pointer</em>!</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8be9fd;font-style:italic>type</span> Example <span style=color:#8be9fd;font-style:italic>struct</span> {
  Info          <span style=color:#8be9fd>string</span> <span style=color:#f1fa8c>`json:&#34;info,omitempty&#34;`</span>
  ExampleValues <span style=color:#ff79c6>*</span><span style=color:#8be9fd;font-style:italic>struct</span> { <span style=color:#6272a4>// use a pointer here
</span><span style=color:#6272a4></span>    DayOfMonth      <span style=color:#8be9fd>int</span>      <span style=color:#f1fa8c>`json:&#34;dayOfMonth,omitempty&#34;`</span>
    DateStr         <span style=color:#8be9fd>string</span>   <span style=color:#f1fa8c>`json:&#34;dateStr,omitempty&#34;`</span>
    SomeRandomFloat <span style=color:#8be9fd>float64</span>  <span style=color:#f1fa8c>`json:&#34;someRandomFloat,omitempty&#34;`</span>
    StrArray        []<span style=color:#8be9fd>string</span> <span style=color:#f1fa8c>`json:&#34;strArray,omitempty&#34;`</span>
    IsWorking       <span style=color:#8be9fd>bool</span>     <span style=color:#f1fa8c>`json:&#34;isWorking,omitempty&#34;`</span>
  } <span style=color:#f1fa8c>`json:&#34;exampleValues,omitempty&#34;`</span>
}
</code></pre></td></tr></table></div></div><p>And the result will be:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#ff79c6>&#34;info&#34;</span>:<span style=color:#f1fa8c>&#34;hello&#34;</span>}
</code></pre></td></tr></table></div></div><h3 id=2-avoid-omitempty-for-fields-that-are-asgined-with-0-or-empty-string>2. Avoid <em><code>omitempty</code></em> for fields that are asgined with 0 or empty string</h3><p>With a struct defined like this:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8be9fd;font-style:italic>type</span> TestStruct <span style=color:#8be9fd;font-style:italic>struct</span> {
  BoolVar      <span style=color:#8be9fd>bool</span>        <span style=color:#f1fa8c>`json:&#34;bool_var,omitempty&#34;`</span>
  IntVar       <span style=color:#8be9fd>int</span>         <span style=color:#f1fa8c>`json:&#34;int_var,omitempty&#34;`</span>
  StringVar    <span style=color:#8be9fd>string</span>      <span style=color:#f1fa8c>`json:&#34;string_var,omitempty&#34;`</span>
}
</code></pre></td></tr></table></div></div><p>Even if we can initialize a <code>TestStruct</code> with some special values and perform a json marshal.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>bb, _ <span style=color:#ff79c6>:=</span> json.<span style=color:#50fa7b>Marshal</span>(<span style=color:#ff79c6>&amp;</span>TestStruct{
  BoolVar:   <span style=color:#ff79c6>false</span>,
  IntVar:    <span style=color:#bd93f9>0</span>,
  StringVar: <span style=color:#f1fa8c>&#34;&#34;</span>,
})

fmt.<span style=color:#50fa7b>Println</span>(<span style=color:#8be9fd;font-style:italic>string</span>(bb))
</code></pre></td></tr></table></div></div><p>What we get will be an empty json object.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{}
</code></pre></td></tr></table></div></div><p>And that might not be something we expected.
Since the tag <code>omitempty</code> means all <strong>empty values</strong> (that are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero) will be omited no matter whether thay are assigned on purpose or not. Sometimes what we need is some kind of feature like <code>ommitnil</code> tag that omit those fields which are not initialized and keep them even if they are initialized with <strong>empty values</strong></p><p>Apparently there is no such tag feature in standard library. To make it work we may have to use <code>interface{}</code>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8be9fd;font-style:italic>type</span> TestStruct2 <span style=color:#8be9fd;font-style:italic>struct</span> {
  BoolVar          <span style=color:#8be9fd>bool</span>        <span style=color:#f1fa8c>`json:&#34;bool_var,omitempty&#34;`</span>
  IntVar           <span style=color:#8be9fd>int</span>         <span style=color:#f1fa8c>`json:&#34;int_var,omitempty&#34;`</span>
  StringVar        <span style=color:#8be9fd>string</span>      <span style=color:#f1fa8c>`json:&#34;string_var,omitempty&#34;`</span>
  InterfaceBoolVar <span style=color:#8be9fd;font-style:italic>interface</span>{} <span style=color:#f1fa8c>`json:&#34;interface_bool_var,omitempty&#34;`</span>
  InterfaceIntVar  <span style=color:#8be9fd;font-style:italic>interface</span>{} <span style=color:#f1fa8c>`json:&#34;interface_int_var,omitempty&#34;`</span>
  InterfaceStrVar  <span style=color:#8be9fd;font-style:italic>interface</span>{} <span style=color:#f1fa8c>`json:&#34;interface_str_var,omitempty&#34;`</span>
}
</code></pre></td></tr></table></div></div><p>To compare, we may initialize <code>TestStruct2</code> twice in different ways, partly and wholly.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>partlyInitialized, _ <span style=color:#ff79c6>:=</span> json.<span style=color:#50fa7b>Marshal</span>(<span style=color:#ff79c6>&amp;</span>TestStruct2{
  BoolVar:   <span style=color:#ff79c6>false</span>,
  IntVar:    <span style=color:#bd93f9>0</span>,
  StringVar: <span style=color:#f1fa8c>&#34;&#34;</span>,
})

whollyInitialized, _ <span style=color:#ff79c6>:=</span> json.<span style=color:#50fa7b>Marshal</span>(<span style=color:#ff79c6>&amp;</span>TestStruct2{
  BoolVar:          <span style=color:#ff79c6>false</span>,
  IntVar:           <span style=color:#bd93f9>0</span>,
  StringVar:        <span style=color:#f1fa8c>&#34;&#34;</span>,
  InterfaceBoolVar: <span style=color:#ff79c6>false</span>,
  InterfaceIntVar:  <span style=color:#bd93f9>0</span>,
  InterfaceStrVar:  <span style=color:#f1fa8c>&#34;&#34;</span>,
})

fmt.<span style=color:#50fa7b>Println</span>(<span style=color:#8be9fd;font-style:italic>string</span>(partlyInitialized))
fmt.<span style=color:#50fa7b>Println</span>(<span style=color:#8be9fd;font-style:italic>string</span>(whollyInitialized))
</code></pre></td></tr></table></div></div><p>And we get will be:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{}
{<span style=color:#ff79c6>&#34;interface_bool_var&#34;</span>:<span style=color:#ff79c6>false</span>,<span style=color:#ff79c6>&#34;interface_int_var&#34;</span>:<span style=color:#bd93f9>0</span>,<span style=color:#ff79c6>&#34;interface_str_var&#34;</span>:<span style=color:#f1fa8c>&#34;&#34;</span>}
</code></pre></td></tr></table></div></div><p>The result lies in the fact that <code>interface{}</code> won&rsquo;t be nil after being initialized even if the data it points to is empty value.</p><h2 id=ii-design-pattern>II. Design Pattern</h2><h3 id=21-singleton>2.1 Singleton</h3><p>Singleton is usually used as a global instance, initialized lazily or eagerly with double concurrent check.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#ff79c6>package</span> singleton

<span style=color:#ff79c6>import</span> <span style=color:#f1fa8c>&#34;sync&#34;</span>

<span style=color:#8be9fd;font-style:italic>var</span> (
	lazySingleton <span style=color:#ff79c6>*</span>Singleton
	once          = <span style=color:#ff79c6>&amp;</span>sync.Once{}
)

<span style=color:#6272a4>// GetLazyInstance
</span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>GetLazyInstance</span>() <span style=color:#ff79c6>*</span>Singleton {
	<span style=color:#ff79c6>if</span> lazySingleton <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
		once.<span style=color:#50fa7b>Do</span>(<span style=color:#8be9fd;font-style:italic>func</span>() {
			lazySingleton = <span style=color:#ff79c6>&amp;</span>Singleton{}
		})
	}
	<span style=color:#ff79c6>return</span> lazySingleton
}
</code></pre></td></tr></table></div></div></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>leizhilong</span></span>
<time>Jun 4, 2020</time>
<span class=categories>Tags:
<a class=category href=https://leizhilong.github.io/tags/golang>Golang</a></span></p><p class=meta><a class="basic-alignment left" href=https://leizhilong.github.io/cheatsheet/kubernetes/ title=Kubernetes>Kubernetes</a>
<a class="basic-alignment right" href=https://leizhilong.github.io/cheatsheet/docker/ title=Docker>Docker</a></p></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>About the Author</h1><p><p>A code lover,
a day dreamer,
a faithful conversation terminator,
a passionate mosquito smasher,
a humble weight scale cheater,
the rightful heir to the sacred throne of wok bearer and the happiest father ever in the Seven Kingdoms.</p><p>Hi, there!
I am a programmer based in Shanghai and focused on technology about Kubernetes, Linux Containers, Mobile App back-end service (Java) and Golang application development.
Here I keep my notes and thoughts about things I&rsquo;m interested in. If you want to know more or talk to me, click on <a href=/about/>About Me</a> or contact me via <a href=https://twitter.com/leizhilong>Twitter</a>.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank href=https://github.com/leizhilong/ title=https://github.com/leizhilong/><i class="fa fa-github fa-3x"></i></a><a target=_blank href=https://twitter.com/leizhilong/ title=https://twitter.com/leizhilong/><i class="fa fa-twitter fa-3x"></i></a><a target=_blank href=https://www.linkedin.com/in/leizhilong/ title=https://www.linkedin.com/in/leizhilong/><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Categories</h1><li><a href=https://leizhilong.github.io/categories/go/ title=Golang>Golang</a></li><li><a href=https://leizhilong.github.io/categories/kubernetes/ title=Kubernetes>Kubernetes</a></li><li><a href=https://leizhilong.github.io/categories/container/ title=Container>Container</a></li><li><a href=https://leizhilong.github.io/categories/linux/ title=Linux>Linux</a></li><li><a href=https://leizhilong.github.io/categories/frontend/ title=Frontend>Frontend</a></li></section><section class=even><h1>Recent Posts</h1><ul id=recent_posts><li class=post><a href=/post/why-swap-should-be-disabled-on-kubernetes/>Why Swap should be disabled on Kubernetes</a></li></ul></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2022 leizhilong - <a href=https://leizhilong.github.io/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io>Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/>Hugo-Octopress</a> theme.</p></footer></body></html>
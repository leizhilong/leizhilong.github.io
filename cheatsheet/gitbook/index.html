<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><title>Gitbook</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://leizhilong.github.io/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Lei Zhilong leizhilong kubernetes linux container golang mobile app back-end service blog]"><meta name=author content="leizhilong"><meta name=generator content="Hugo 0.75.1"><meta name=twitter:card content="summary"><meta name=twitter:title content="Gitbook"><meta name=twitter:description content="I. Installation 1. The Mismatched graceful-fs dependency Since gitbook has been abandoned for quite a long time, it&rsquo;s a mess to install gitbook from scratch for someone who has to keep using it. The most common problem that they would definitely face is the mismatched graceful-fs dependency. When you clone some gitbook from github, the first thing to do is to install gitbook dependencies.
1 2 3 4  gitbook install # or just try to display gitbook version gitbook -V   With no doubt, graceful-fs would be the one reported causing a problem."><meta name=twitter:domain content="leizhilong"><meta name=twitter:creator content="@leizhilong"></head><body><header role=banner><hgroup><h1><a href=https://leizhilong.github.io/>Lei Zhilong</a></h1><h2>The best way to input is to output</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value;">
<option value>Navigate…</option>
<option value=https://leizhilong.github.io/post/>» Posts</option>
<option value=https://leizhilong.github.io/categories/>» Categories</option>
<option value=https://leizhilong.github.io/tags/>» Tags</option>
<option value=https://leizhilong.github.io/cheatsheet/>» CheatSheets</option>
<option value=https://leizhilong.github.io/about/>» About Me</option></select></fieldset><ul class=main-navigation><li><a href=https://leizhilong.github.io/post/ title=Posts>Posts</a></li><li><a href=https://leizhilong.github.io/categories/ title=Categories>Categories</a></li><li><a href=https://leizhilong.github.io/tags/ title=Tags>Tags</a></li><li><a href=https://leizhilong.github.io/cheatsheet/ title=CheatSheets>CheatSheets</a></li><li><a href=https://leizhilong.github.io/about/ title="About Me">About Me</a></li></ul><ul class=subscription><a href=https://leizhilong.github.io/index.xml target=_blank type=application/rss+xml title=RSS><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://leizhilong.github.io/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Jun 4, 2021
- 2 minute read
- <a href=https://leizhilong.github.io/cheatsheet/gitbook/#disqus_thread>Comments</a>
- <a class=label href=https://leizhilong.github.io/categories/cheat-sheets/>Cheat Sheets</a></p><h1 class=entry-title>Gitbook</h1></header><div class=entry-content><nav id=TableOfContents><ul><li><a href=#i-installation>I. Installation</a><ul><li><a href=#1-the-mismatched-graceful-fs-dependency>1. The Mismatched <code>graceful-fs</code> dependency</a></li></ul></li></ul></nav><h2 id=i-installation>I. Installation</h2><h3 id=1-the-mismatched-graceful-fs-dependency>1. The Mismatched <code>graceful-fs</code> dependency</h3><p>Since gitbook has been abandoned for quite a long time, it&rsquo;s a mess to install gitbook from scratch for someone who has to keep using it. The most common problem that they would definitely face is the mismatched <code>graceful-fs</code> dependency. When you clone some gitbook from github, the first thing to do is to install gitbook dependencies.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gitbook install

<span style=color:#6272a4># or just try to  display gitbook version</span>
gitbook -V
</code></pre></td></tr></table></div></div><p>With no doubt, <code>graceful-fs</code> would be the one reported causing a problem.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>info: installing <span style=color:#bd93f9>4</span> plugins using npm@3.9.2
info:
info: installing plugin <span style=color:#f1fa8c>&#34;image-captions&#34;</span>
info: install plugin <span style=color:#f1fa8c>&#34;image-captions&#34;</span> <span style=color:#ff79c6>(</span>*<span style=color:#ff79c6>)</span> from NPM with version 3.1.0
loadCurrentTree           ▄ ╢░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╟
/usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287
      <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>cb<span style=color:#ff79c6>)</span> cb.apply<span style=color:#ff79c6>(</span>this, arguments<span style=color:#ff79c6>)</span>
                 ^

TypeError: cb.apply is not a <span style=color:#ff79c6>function</span>
    at /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287:18
    at FSReqCallback.oncomplete <span style=color:#ff79c6>(</span>node:fs:195:5<span style=color:#ff79c6>)</span>
</code></pre></td></tr></table></div></div><p>However, the root cause of problem lies on that a mismatched version of <code>graceful-fs</code> is used as a dependency and no one is there to fix gitbook. For most environments, updating <code>graceful-fs</code> to the latest version will do the fix.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>
<span style=color:#6272a4># go to gitbook dependency folder</span>
<span style=color:#8be9fd;font-style:italic>cd</span> /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/
<span style=color:#6272a4># update gitbook to latest version</span>
npm install graceful-fs@latest --save
</code></pre></td></tr></table></div></div><p>Unluckily, if some specific plugins might not be compatible with the latest version of <code>graceful-fs</code>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>info: installing <span style=color:#bd93f9>4</span> plugins using npm@3.9.2
info:
info: installing plugin <span style=color:#f1fa8c>&#34;image-captions&#34;</span>
info: install plugin <span style=color:#f1fa8c>&#34;image-captions&#34;</span> <span style=color:#ff79c6>(</span>*<span style=color:#ff79c6>)</span> from NPM with version 3.1.0
loadCurrentTree           ▄ ╢░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╟
node:internal/streams/readable:879
    state.readableListening <span style=color:#ff79c6>=</span> this.listenerCount<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;readable&#39;</span><span style=color:#ff79c6>)</span> &gt; 0;
                            ^

TypeError: Cannot <span style=color:#8be9fd;font-style:italic>set</span> property <span style=color:#f1fa8c>&#39;readableListening&#39;</span> of undefined
    at ReadStream.Readable.on <span style=color:#ff79c6>(</span>node:internal/streams/readable:879:29<span style=color:#ff79c6>)</span>
    at untarStream <span style=color:#ff79c6>(</span>/Users/fakeUser/.gitbook/versions/3.2.3/node_modules/npm/lib/fetch-package-metadata.js:304:8<span style=color:#ff79c6>)</span>
    at addShrinkwrap <span style=color:#ff79c6>(</span>/Users/fakeUser/.gitbook/versions/3.2.3/node_modules/npm/lib/fetch-package-metadata.js:200:3<span style=color:#ff79c6>)</span>
    at /Users/fakeUser/.gitbook/versions/3.2.3/node_modules/npm/lib/fetch-package-metadata.js:185:14
    at /Users/fakeUser/.gitbook/versions/3.2.3/node_modules/npm/node_modules/iferr/index.js:13:50
    at RES <span style=color:#ff79c6>(</span>/Users/fakeUser/.gitbook/versions/3.2.3/node_modules/npm/node_modules/inflight/inflight.js:23:14<span style=color:#ff79c6>)</span>
    at f <span style=color:#ff79c6>(</span>/Users/fakeUser/.gitbook/versions/3.2.3/node_modules/npm/node_modules/once/once.js:17:25<span style=color:#ff79c6>)</span>
    at /Users/fakeUser/.gitbook/versions/3.2.3/node_modules/npm/lib/cache.js:362:16
    at /Users/fakeUser/.gitbook/versions/3.2.3/node_modules/npm/node_modules/write-file-atomic/index.js:29:9
    at LOOP <span style=color:#ff79c6>(</span>/Users/fakeUser/.gitbook/versions/3.2.3/node_modules/npm/node_modules/slide/lib/chain.js:7:26<span style=color:#ff79c6>)</span>
</code></pre></td></tr></table></div></div><p>According to this <a href=https://stackoverflow.com/questions/64211386/gitbook-cli-install-error-typeerror-cb-apply-is-not-a-function-inside-graceful>question on stackoverflow</a>, the vesion &lsquo;4.2.0&rsquo; of <code>graceful-fs</code> is recommanded.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#6272a4># change gitbook to the version 4.2.0</span>
npm install graceful-fs@4.2.0 --save
</code></pre></td></tr></table></div></div></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>leizhilong</span></span>
<time>Jun 4, 2021</time>
<span class=categories>Tags:
<a class=category href=https://leizhilong.github.io/tags/gitbook>Gitbook</a></span></p><p class=meta><a class="basic-alignment left" href=https://leizhilong.github.io/cheatsheet/linux/ title=Linux>Linux</a></p></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>About the Author</h1><p><p>A code lover,
a day dreamer,
a faithful conversation terminator,
a passionate mosquito smasher,
a humble weight scale cheater,
the rightful heir to the sacred throne of wok bearer and the happiest father ever in the Seven Kingdoms.</p><p>Hi, there!
I am a programmer based in Shanghai and focused on technology about Kubernetes, Linux Containers, Mobile App back-end service (Java) and Golang application development.
Here I keep my notes and thoughts about things I&rsquo;m interested in. If you want to know more or talk to me, click on <a href=/about/>About Me</a> or contact me via <a href=https://twitter.com/leizhilong>Twitter</a>.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank href=https://github.com/leizhilong/ title=https://github.com/leizhilong/><i class="fa fa-github fa-3x"></i></a><a target=_blank href=https://twitter.com/leizhilong/ title=https://twitter.com/leizhilong/><i class="fa fa-twitter fa-3x"></i></a><a target=_blank href=https://www.linkedin.com/in/leizhilong/ title=https://www.linkedin.com/in/leizhilong/><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Categories</h1><li><a href=https://leizhilong.github.io/categories/go/ title=Golang>Golang</a></li><li><a href=https://leizhilong.github.io/categories/kubernetes/ title=Kubernetes>Kubernetes</a></li><li><a href=https://leizhilong.github.io/categories/container/ title=Container>Container</a></li><li><a href=https://leizhilong.github.io/categories/linux/ title=Linux>Linux</a></li><li><a href=https://leizhilong.github.io/categories/frontend/ title=Frontend>Frontend</a></li></section><section class=even><h1>Recent Posts</h1><ul id=recent_posts><li class=post><a href=/post/why-swap-should-be-disabled-on-kubernetes/>Why Swap should be disabled on Kubernetes</a></li></ul></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2021 leizhilong - <a href=https://leizhilong.github.io/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io>Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/>Hugo-Octopress</a> theme.</p></footer></body></html>
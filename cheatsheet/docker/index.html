<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><title>Docker</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://leizhilong.github.io/favicon.png rel=icon><meta name=description content><meta name=keywords content="[Lei Zhilong leizhilong kubernetes linux container golang mobile app back-end service blog]"><meta name=author content="leizhilong"><meta name=generator content="Hugo 0.75.1"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker"><meta name=twitter:description content="I. Installation 1. Debug Docker desktop for macOS log in terminal To get Docker desktop for macOS log, try this
1 2 3 4 5  pred='process matches &#34;.*(ocker|vpnkit).*&#34; || (process in {&#34;taskgated-helper&#34;, &#34;launchservicesd&#34;, &#34;kernel&#34;} && eventMessage contains[c] &#34;docker&#34;)' /usr/bin/log stream --style syslog --level=debug --color=always --predicate &#34;$pred&#34;   II. Usage 1. Container does not respond to Ctrl + C Cause
 The problem is that Ctrl-C sends a signal to the top-level process inside the container, but that process doesn&rsquo;t necessarily react as you would expect."><meta name=twitter:domain content="leizhilong"><meta name=twitter:creator content="@leizhilong"></head><body><header role=banner><hgroup><h1><a href=https://leizhilong.github.io/>Lei Zhilong</a></h1><h2>The best way to input is to output,</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value;">
<option value>Navigate…</option>
<option value=https://leizhilong.github.io/post/>» Posts</option>
<option value=https://leizhilong.github.io/categories/>» Categories</option>
<option value=https://leizhilong.github.io/tags/>» Tags</option>
<option value=https://leizhilong.github.io/cheatsheet/>» CheatSheets</option>
<option value=https://leizhilong.github.io/about/>» About Me</option></select></fieldset><ul class=main-navigation><li><a href=https://leizhilong.github.io/post/ title=Posts>Posts</a></li><li><a href=https://leizhilong.github.io/categories/ title=Categories>Categories</a></li><li><a href=https://leizhilong.github.io/tags/ title=Tags>Tags</a></li><li><a href=https://leizhilong.github.io/cheatsheet/ title=CheatSheets>CheatSheets</a></li><li><a href=https://leizhilong.github.io/about/ title="About Me">About Me</a></li></ul><ul class=subscription><a href=https://leizhilong.github.io/index.xml target=_blank type=application/rss+xml title=RSS><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://leizhilong.github.io/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>Jun 4, 2020
- 4 minute read
- <a href=https://leizhilong.github.io/cheatsheet/docker/#disqus_thread>Comments</a>
- <a class=label href=https://leizhilong.github.io/categories/cheat-sheets/>Cheat Sheets</a></p><h1 class=entry-title>Docker</h1></header><div class=entry-content><nav id=TableOfContents><ul><li><a href=#i-installation>I. Installation</a><ul><li><a href=#1-debug-docker-desktop-for-macos-log-in-terminal>1. Debug Docker desktop for macOS log in terminal</a></li></ul></li><li><a href=#ii-usage>II. Usage</a><ul><li><a href=#1-container-does-not-respond-to-ctrl--c>1. Container does not respond to <code>Ctrl + C</code></a></li><li><a href=#2-exec-form-or-shell-form-in-dockerfile>2. <code>exec</code> form or <code>shell</code> form in Dockerfile</a></li></ul></li></ul></nav><h2 id=i-installation>I. Installation</h2><h3 id=1-debug-docker-desktop-for-macos-log-in-terminal>1. Debug Docker desktop for macOS log in terminal</h3><p>To get Docker desktop for macOS log, try this</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>
<span style=color:#8be9fd;font-style:italic>pred</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;process matches &#34;.*(ocker|vpnkit).*&#34;
</span><span style=color:#f1fa8c>  || (process in {&#34;taskgated-helper&#34;, &#34;launchservicesd&#34;, &#34;kernel&#34;} &amp;&amp; eventMessage contains[c] &#34;docker&#34;)&#39;</span>
/usr/bin/log stream --style syslog --level<span style=color:#ff79c6>=</span>debug --color<span style=color:#ff79c6>=</span>always --predicate <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$pred</span><span style=color:#f1fa8c>&#34;</span>

</code></pre></td></tr></table></div></div><h2 id=ii-usage>II. Usage</h2><h3 id=1-container-does-not-respond-to-ctrl--c>1. Container does not respond to <code>Ctrl + C</code></h3><p><strong>Cause</strong></p><blockquote><p>The problem is that <code>Ctrl-C</code> sends a signal to the top-level process inside the container, but that process doesn&rsquo;t necessarily react as you would expect. The top-level process has ID 1 inside the container, which means that it doesn&rsquo;t get the default signal handlers that processes usually have. If the top-level process is a shell, then it can receive the signal through its own handler, but doesn&rsquo;t forward it to the command that is executed within the shell.</p></blockquote><p><strong>Solution</strong></p><blockquote><p>Specify an init process
You can use the <code>--init</code> flag to indicate that an init process should be used as the PID 1 in the container. Specifying an init process ensures the usual responsibilities of an init system, such as reaping zombie processes, are performed inside the created container.</p><p>The default init process used is the first docker-init executable found in the system path of the Docker daemon process. This <code>docker-init</code> binary, included in the default installation, is backed by <a href=https://github.com/krallin/tini>tini</a>.</p></blockquote><p><strong>Sample</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>
docker run -v <span style=color:#f1fa8c>`</span><span style=color:#8be9fd;font-style:italic>pwd</span><span style=color:#f1fa8c>`</span>:/srv/gitbook -p 4000:4000 --rm --init leizhilong/gitbook gitbook serve

</code></pre></td></tr></table></div></div><p><strong>Referecne</strong></p><ul><li><a href=https://stackoverflow.com/questions/41097652/how-to-fix-ctrlc-inside-a-docker-container>https://stackoverflow.com/questions/41097652/how-to-fix-ctrlc-inside-a-docker-container</a></li><li><a href=https://docs.docker.com/engine/reference/run/#specify-an-init-process>https://docs.docker.com/engine/reference/run/#specify-an-init-process</a></li></ul><h3 id=2-exec-form-or-shell-form-in-dockerfile>2. <code>exec</code> form or <code>shell</code> form in Dockerfile</h3><p>There are two ways to specify a start command in Dockerfile, <code>entrypoint</code> and <code>cmd</code>.</p><p><strong>ENTRYPOINT</strong></p><ol><li><code>exec</code> form ENTRYPOINT</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=color:#6272a4># preferred form</span>
<span style=color:#ff79c6>ENTRYPOINT</span> [<span style=color:#f1fa8c>&#34;executable&#34;</span>, <span style=color:#f1fa8c>&#34;param1&#34;</span>, <span style=color:#f1fa8c>&#34;param2&#34;</span>]
</code></pre></td></tr></table></div></div><ol start=2><li><code>shell</code> form ENTRYPOINT</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=color:#ff79c6>ENTRYPOINT</span> <span style=color:#8be9fd;font-style:italic>command</span> param1 param2

<span style=color:#6272a4># Which means the same as:</span>
<span style=color:#ff79c6>ENTRYPOINT</span> [<span style=color:#f1fa8c>&#34;sh&#34;</span>, <span style=color:#f1fa8c>&#34;-c, &#34;</span>command param<span style=color:#bd93f9>1</span> param<span style=color:#bd93f9>2</span>&#34;]
</code></pre></td></tr></table></div></div><p><strong>CMD</strong></p><ol><li><code>exec</code> form CMD</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=color:#6272a4># preferred form</span>
<span style=color:#ff79c6>CMD</span> [<span style=color:#f1fa8c>&#34;executable&#34;</span>, <span style=color:#f1fa8c>&#34;param1&#34;</span>, <span style=color:#f1fa8c>&#34;param2&#34;</span>]
</code></pre></td></tr></table></div></div><ol start=2><li><code>shell</code> form CMD</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=color:#ff79c6>CMD</span> <span style=color:#8be9fd;font-style:italic>command</span> param1 param2

<span style=color:#6272a4># Which means the same as:</span>
<span style=color:#ff79c6>CMD</span> [<span style=color:#f1fa8c>&#34;sh&#34;</span>, <span style=color:#f1fa8c>&#34;-c, &#34;</span>command param<span style=color:#bd93f9>1</span> param<span style=color:#bd93f9>2</span>&#34;]
</code></pre></td></tr></table></div></div><ol start=3><li><code>exec</code> parameter form CMD</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=color:#ff79c6>CMD</span> [<span style=color:#f1fa8c>&#34;param1&#34;</span>, <span style=color:#f1fa8c>&#34;param2&#34;</span>]


<span style=color:#6272a4># Which means the same as:</span>
<span style=color:#ff79c6>ENTRYPOINT</span> [<span style=color:#f1fa8c>&#34;executable&#34;</span>, <span style=color:#f1fa8c>&#34;param1&#34;</span>,<span style=color:#f1fa8c>&#34;param2&#34;</span>]
</code></pre></td></tr></table></div></div><p><strong>Diferences between <code>exec</code> form and <code>shell</code> form</strong></p><p>The <em>shell</em> form prevents any CMD or run command line arguments from being used, but has the disadvantage that your ENTRYPOINT will be started as a subcommand of <code>/bin/sh -c</code>, which does not pass signals. This means that the executable will not be the container’s PID 1 - and will not receive Unix signals - so your executable will not receive a <code>SIGTERM</code> from <code>docker stop &lt;container></code>.</p><p>Unlike the shell form, the exec form does not invoke a command shell. This means that normal shell processing does not happen. For example, <code>CMD [ "echo", "$HOME" ]</code> will not do variable substitution on <code>$HOME</code>. If you want shell processing then either use the shell form or execute a shell directly, for example: <code>CMD [ "sh", "-c", "echo $HOME" ]</code>. When using the exec form and executing a shell directly, as in the case for the shell form, it is the shell that is doing the environment variable expansion, not docker.</p><p>When used in the shell or exec formats, the <code>CMD</code> instruction sets the command to be executed when running the image.</p><p>To sumarize:</p><ul><li><code>shell</code> form runs your command as a subcommand of shell <code>/bin/sh -c</code>, which prevents your command to receive system signals.</li><li><code>exec</code> form runs your commnad directly without a shell enviroment, which means system signals can be received but shell enviroment variables such as <code>$HOME</code> won&rsquo;t be substituted.</li></ul><p><strong><code>CMD</code> and <code>ENTRYPOINT</code> combination</strong></p><ol><li><p>Dockerfile should specify at least one of <code>CMD</code> or <code>ENTRYPOINT</code> commands.</p></li><li><p><code>ENTRYPOINT</code> should be defined when using the container as an executable.</p></li><li><p><code>CMD</code> should be used as a way of defining default arguments for an <code>ENTRYPOINT</code> command or for executing an ad-hoc command in a container.</p></li><li><p><code>CMD</code> will be overridden when running the container with alternative arguments.</p></li></ol><p><img src=./images/entrypoint-and-cmd.png alt=entrypoint-and-cmd></p><p><strong>Reference</strong></p><ul><li><a href=https://docs.docker.com/engine/reference/builder/#cmd>https://docs.docker.com/engine/reference/builder/#cmd</a></li><li><a href=https://docs.docker.com/engine/reference/builder/#entrypoint>https://docs.docker.com/engine/reference/builder/#entrypoint</a></li></ul></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>leizhilong</span></span>
<time>Jun 4, 2020</time>
<span class=categories>Tags:
<a class=category href=https://leizhilong.github.io/tags/docker>Docker</a></span></p><p class=meta><a class="basic-alignment left" href=https://leizhilong.github.io/cheatsheet/golang/ title=Golang>Golang</a>
<a class="basic-alignment right" href=https://leizhilong.github.io/cheatsheet/git/ title=Git>Git</a></p></footer></article></div><aside class="sidebar thirds"><section class="first odd"><h1>About the Author</h1><p><p>A code lover,
a day dreamer,
a faithful conversation terminator,
a passionate mosquito smasher,
a humble weight scale cheater,
the rightful heir to the sacred throne of wok bearer and the happiest father ever in the Seven Kingdoms.</p><p>Hi, there!
I am a programmer based in Shanghai and focused on technology about Kubernetes, Linux Containers, Mobile App back-end service (Java) and Golang application development.
Here I keep my notes and thoughts about things I&rsquo;m interested in. If you want to know more or talk to me, click on <a href=/about/>About Me</a> or contact me via <a href=https://twitter.com/leizhilong>Twitter</a>.</p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank href=https://github.com/leizhilong/ title=https://github.com/leizhilong/><i class="fa fa-github fa-3x"></i></a><a target=_blank href=https://twitter.com/leizhilong/ title=https://twitter.com/leizhilong/><i class="fa fa-twitter fa-3x"></i></a><a target=_blank href=https://www.linkedin.com/in/leizhilong/ title=https://www.linkedin.com/in/leizhilong/><i class="fa fa-linkedin fa-3x"></i></a></li></ul><section class=odd><h1>Categories</h1><li><a href=https://leizhilong.github.io/categories/go/ title=Golang>Golang</a></li><li><a href=https://leizhilong.github.io/categories/kubernetes/ title=Kubernetes>Kubernetes</a></li><li><a href=https://leizhilong.github.io/categories/container/ title=Container>Container</a></li><li><a href=https://leizhilong.github.io/categories/linux/ title=Linux>Linux</a></li><li><a href=https://leizhilong.github.io/categories/frontend/ title=Frontend>Frontend</a></li></section><section class=even><h1>Recent Posts</h1><ul id=recent_posts><li class=post><a href=/post/why-swap-should-be-disabled-on-kubernetes/>Why Swap should be disabled on Kubernetes</a></li></ul></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2021 leizhilong - <a href=https://leizhilong.github.io/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io>Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/>Hugo-Octopress</a> theme.</p></footer></body></html>